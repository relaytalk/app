<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>RelayTalk</title>

    <!-- Basic SEO -->
    <meta name="description" content="RelayTalk - Connect with friends instantly">
    <meta name="keywords" content="RelayTalk, messaging, chat, friends">

    <!-- Open Graph - UPDATED for Vercel -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="RelayTalk">
    <meta property="og:title" content="RelayTalk">
    <meta property="og:description" content="RelayTalk - Connect with friends instantly">
    <meta property="og:url" content="https://relaytalk.vercel.app/">
    <meta property="og:image" content="https://relaytalk.vercel.app/relay.png">
    <meta property="og:image:width" content="512">
    <meta property="og:image:height" content="512">
    <meta property="og:image:alt" content="RelayTalk">
    <meta property="og:locale" content="en_US">

    <!-- Twitter - UPDATED for Vercel -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@RelayTalk">
    <meta name="twitter:title" content="RelayTalk">
    <meta name="twitter:description" content="RelayTalk - Connect with friends instantly">
    <meta name="twitter:image" content="https://relaytalk.vercel.app/relay.png">
    <meta name="twitter:creator" content="@RelayTalk">

    <!-- Canonical - UPDATED for Vercel -->
    <link rel="canonical" href="https://relaytalk.vercel.app/">

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/relay.png" type="image/png" sizes="192x192">
    <link rel="icon" href="/relay.png" type="image/png" sizes="512x512">
    <link rel="apple-touch-icon" href="/relay.png">

    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0a0a1a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="RelayTalk">
    <meta name="application-name" content="RelayTalk">

    <!-- Structured Data - UPDATED for Vercel -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "RelayTalk",
      "url": "https://relaytalk.vercel.app/",
      "description": "RelayTalk - Connect with friends instantly",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://relaytalk.vercel.app/search?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/opening.css">

    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.getRegistrations()
                    .then(registrations => {
                        return Promise.all(registrations.map(r => r.unregister()));
                    })
                    .then(() => {
                        return navigator.serviceWorker.register('/service-worker.js', {
                            scope: '/',
                            updateViaCache: 'none'
                        });
                    })
                    .then(registration => {
                        if (registration.active) {
                            setTimeout(() => {
                                if (navigator.onLine && registration.active) {
                                    registration.active.postMessage({ 
                                        type: 'AUTO_CACHE_GAME' 
                                    });
                                }
                            }, 2000);
                        }
                        registration.update();
                    })
                    .catch(error => {
                        console.log('Service Worker error:', error);
                    });
            });
        }

        if (window.location.search.indexOf('fresh') !== -1) {
            localStorage.clear();
            sessionStorage.clear();
        }
    </script>

    <style>
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        .standalone-mode .bottom-nav { 
            padding-bottom: env(safe-area-inset-bottom); 
        }
        @media (display-mode: standalone) {
            .install-prompt { display: none !important; }
        }
        @media print {
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>
    <div class="opening-screen" id="openingScreen">
        <div class="luster-text">‚ú®Relay</div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="welcome-container">
            <div class="logo">‚ú®</div>
            <h1 class="title">RelayTalk</h1>
            <p class="subtitle">Connect with friends instantly</p>

            <div class="features">
                <div class="feature-card">
                    <div class="feature-icon">üîç</div>
                    <h3>Search Friends</h3>
                    <p>Find and connect with friends</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üîî</div>
                    <h3>Notifications</h3>
                    <p>Stay updated with messages</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üí¨</div>
                    <h3>Instant Chat</h3>
                    <p>Real-time messaging</p>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn-primary" onclick="goToSignup()">Create Account</button>
                <button class="btn-secondary" onclick="goToLogin()">Login</button>
            </div>
        </div>
    </div>

    <script>
        function goToLogin() { 
            window.location.href = '/pages/login/index.html?v=' + Date.now();
        }

        function goToSignup() { 
            window.location.href = '/pages/auth/index.html?v=' + Date.now();
        }

        window.goToLogin = goToLogin;
        window.goToSignup = goToSignup;

        document.addEventListener('DOMContentLoaded', function() {
            const links = document.querySelectorAll('a[href^="/"]');
            links.forEach(link => {
                const href = link.getAttribute('href');
                if (href && !href.includes('?')) {
                    link.setAttribute('href', href + '?v=' + Date.now());
                }
            });
        });
    </script>

    <script type="module">
        import { auth } from '/utils/auth.js';

        async function checkUserAndRedirect() {
            try {
                const { success, user } = await auth.getCurrentUser();
                if (success && user) {
                    window.location.href = '/pages/home/index.html?v=' + Date.now();
                    return;
                }
            } catch (error) { 
                console.error("Auth error:", error);
            }

            setTimeout(() => {
                const openingScreen = document.getElementById('openingScreen');
                const mainContent = document.getElementById('mainContent');

                if (openingScreen) {
                    openingScreen.style.transition = 'opacity 0.5s ease';
                    openingScreen.style.opacity = '0';
                    setTimeout(() => {
                        openingScreen.style.display = 'none';
                    }, 500);
                }

                if (mainContent) {
                    mainContent.style.display = 'block';
                    setTimeout(() => {
                        mainContent.style.opacity = '1';
                        mainContent.style.transition = 'opacity 0.5s ease';
                    }, 100);
                }
            }, 1000);
        }

        document.addEventListener('DOMContentLoaded', checkUserAndRedirect);
    </script>

    <script src="/utils/sw-manager.js"></script>
</body>
</html>