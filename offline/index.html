<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline Entertainment</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            text-align: center;
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 40px;
            color: #a0a0c0;
        }

        .offline-badge {
            background: #ff7e5f;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .sections-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            margin-top: 20px;
        }

        .section-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            width: 350px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .section-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.4);
        }

        .section-title {
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .shayari-card .section-title {
            color: #ff7e5f;
        }

        .tv-card .section-title {
            color: #6a93ff;
        }

        .section-description {
            font-size: 1.1rem;
            margin-bottom: 30px;
            color: #c0c0e0;
            line-height: 1.6;
        }

        .btn {
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
        }

        .shayari-btn {
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            color: white;
        }

        .shayari-btn:hover {
            background: linear-gradient(to right, #ff6b47, #fea05c);
            box-shadow: 0 5px 15px rgba(255, 126, 95, 0.4);
        }

        .tv-btn {
            background: linear-gradient(to right, #6a93ff, #4d7df0);
            color: white;
        }

        .tv-btn:hover {
            background: linear-gradient(to right, #5a83ff, #3d6de0);
            box-shadow: 0 5px 15px rgba(106, 147, 255, 0.4);
        }

        .icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .shayari-icon {
            color: #ff7e5f;
        }

        .tv-icon {
            color: #6a93ff;
        }

        .service-worker-status {
            margin-top: 40px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            font-size: 0.9rem;
        }

        .status-online {
            color: #4caf50;
        }

        .status-offline {
            color: #ff5252;
        }

        .cache-status {
            color: #ffd166;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .sections-container {
                flex-direction: column;
                align-items: center;
            }

            .section-card {
                width: 100%;
                max-width: 400px;
            }

            h1 {
                font-size: 2.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Offline Entertainment</h1>
        <div class="subtitle">Enjoy these sections even without internet connection</div>

        <div class="offline-badge">All content works offline</div>

        <div class="sections-container">
            <div class="section-card shayari-card">
                <div class="icon shayari-icon">ðŸ’Œ</div>
                <h2 class="section-title">Shayari Section</h2>
                <p class="section-description">
                    Enjoy beautiful shayaris about love, life, and emotions. Read 15 heart-touching shayaris with next/previous navigation.
                </p>
                <a href="/offline/section1/main.html" class="btn shayari-btn">Open Shayari Section</a>
            </div>

            <div class="section-card tv-card">
                <div class="icon tv-icon">ðŸ“º</div>
                <h2 class="section-title">TV Section</h2>
                <p class="section-description">
                    Experience a retro pixelated TV with 10 different images. Use the remote to navigate between channels.
                </p>
                <a href="/offline/section2/main.html" class="btn tv-btn">Open TV Section</a>
            </div>
        </div>

        <div class="service-worker-status">
            <div>Service Worker Status: <span id="sw-status">Checking...</span></div>
            <div class="cache-status">Cache Status: <span id="cache-status">Checking...</span></div>
            <div>Connection: <span id="connection-status" class="status-online">Online</span></div>
        </div>
    </div>

    <script>
        // FIXED: Use absolute paths for base URL detection
        const BASE_PATH = window.location.origin;
        const IS_OFFLINE_PAGE = window.location.pathname.includes('/offline/');
        
        // Function to ensure correct paths
        function fixLinks() {
            // Fix all links that might have relative paths
            document.querySelectorAll('a').forEach(link => {
                const href = link.getAttribute('href');
                if (href && !href.startsWith('http') && !href.startsWith('#')) {
                    if (!href.startsWith('/')) {
                        // Convert relative to absolute path
                        if (href.startsWith('section1/') || href.startsWith('section2/')) {
                            link.href = '/offline/' + href;
                        } else {
                            link.href = '/' + href;
                        }
                    }
                }
            });
        }

        // Fix links on page load
        document.addEventListener('DOMContentLoaded', fixLinks);

        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/service-worker.js');
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    document.getElementById('sw-status').textContent = 'Registered';
                    document.getElementById('sw-status').style.color = '#4caf50';

                    // Check if cache is available
                    if (registration.active) {
                        document.getElementById('cache-status').textContent = 'Active';
                        document.getElementById('cache-status').style.color = '#4caf50';
                    }
                } catch (error) {
                    console.log('ServiceWorker registration failed: ', error);
                    document.getElementById('sw-status').textContent = 'Failed';
                    document.getElementById('sw-status').style.color = '#ff5252';
                }
            });
        } else {
            document.getElementById('sw-status').textContent = 'Not Supported';
            document.getElementById('sw-status').style.color = '#ff5252';
        }

        // Update connection status
        function updateConnectionStatus() {
            const connectionStatus = document.getElementById('connection-status');
            if (navigator.onLine) {
                connectionStatus.textContent = 'Online';
                connectionStatus.className = 'status-online';
            } else {
                connectionStatus.textContent = 'Offline';
                connectionStatus.className = 'status-offline';
            }
        }

        // Prevent navigation issues
        document.addEventListener('click', function(event) {
            if (event.target.tagName === 'A') {
                const href = event.target.getAttribute('href');
                if (href && (href.includes('section1/') || href.includes('section2/'))) {
                    if (!href.startsWith('/offline/')) {
                        event.preventDefault();
                        window.location.href = '/offline/' + href.replace(/^\/?offline\//, '');
                    }
                }
            }
        });

        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);
        updateConnectionStatus();

        // Debug: Log current path for troubleshooting
        console.log('Current path:', window.location.pathname);
        console.log('Base path:', BASE_PATH);
    </script>
</body>
</html>